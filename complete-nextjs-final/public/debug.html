<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Emergency Mobile Debug</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            min-height: 100vh;
        }
        .debug-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 999999;
        }
        .debug-info {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-size: 12px;
        }
        h1 { color: #fbbf24; }
        h2 { color: #34d399; }
    </style>
</head>
<body>
    <h1>🚨 Emergency Mobile Debug Console</h1>
    <p>If you're seeing this, the main app failed to load. This emergency console will help us debug the issue.</p>
    
    <h2>Environment Information:</h2>
    <div class="debug-info" id="environment-info">Loading...</div>
    
    <h2>Capacitor Status:</h2>
    <div class="debug-info" id="capacitor-info">Loading...</div>
    
    <h2>Error Log:</h2>
    <div class="debug-info" id="error-log">No errors yet...</div>
    
    <h2>Network Tests:</h2>
    <div class="debug-info" id="network-tests">
        <button onclick="testConnectivity()" style="padding: 10px; margin: 5px;">Test Network</button>
        <button onclick="testCapacitor()" style="padding: 10px; margin: 5px;">Test Capacitor</button>
        <button onclick="copyReport()" style="padding: 10px; margin: 5px;">Copy Report</button>
    </div>
    
    <div class="debug-info" id="test-results"></div>

    <script>
        let errorLog = [];
        
        // Capture all errors
        window.addEventListener('error', (e) => {
            const error = `ERROR: ${e.message} at ${e.filename}:${e.lineno}`;
            errorLog.push(error);
            updateErrorLog();
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            const error = `PROMISE REJECTION: ${e.reason}`;
            errorLog.push(error);
            updateErrorLog();
        });
        
        function updateErrorLog() {
            document.getElementById('error-log').textContent = 
                errorLog.length > 0 ? errorLog.join('\n') : 'No errors yet...';
        }
        
        function collectEnvironmentInfo() {
            const info = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                location: {
                    protocol: window.location.protocol,
                    hostname: window.location.hostname,
                    pathname: window.location.pathname,
                    href: window.location.href
                },
                screen: {
                    width: screen.width,
                    height: screen.height,
                    devicePixelRatio: window.devicePixelRatio
                },
                viewport: {
                    width: window.innerWidth,
                    height: window.innerHeight
                },
                capabilities: {
                    localStorage: !!window.localStorage,
                    indexedDB: !!window.indexedDB,
                    serviceWorker: 'serviceWorker' in navigator,
                    geolocation: 'geolocation' in navigator,
                    onLine: navigator.onLine
                }
            };
            
            document.getElementById('environment-info').textContent = JSON.stringify(info, null, 2);
            return info;
        }
        
        function checkCapacitor() {
            let capacitorInfo = {
                hasCapacitor: !!window.Capacitor,
                isNative: false,
                platform: 'unknown',
                plugins: []
            };
            
            try {
                if (window.Capacitor) {
                    capacitorInfo.isNative = window.Capacitor.isNativePlatform();
                    capacitorInfo.platform = window.Capacitor.getPlatform();
                    capacitorInfo.plugins = Object.keys(window.Capacitor.Plugins || {});
                }
            } catch (e) {
                capacitorInfo.error = e.toString();
            }
            
            document.getElementById('capacitor-info').textContent = JSON.stringify(capacitorInfo, null, 2);
            return capacitorInfo;
        }
        
        async function testConnectivity() {
            const results = [];
            
            // Test basic connectivity
            results.push(`Online status: ${navigator.onLine ? 'Online' : 'Offline'}`);
            
            // Test fetch capabilities
            try {
                const response = await fetch('data:text/plain,test');
                results.push('✅ Fetch API working');
            } catch (e) {
                results.push(`❌ Fetch API failed: ${e.message}`);
            }
            
            document.getElementById('test-results').textContent = results.join('\n');
        }
        
        async function testCapacitor() {
            const results = [];
            
            if (!window.Capacitor) {
                results.push('❌ Capacitor not found');
                document.getElementById('test-results').textContent = results.join('\n');
                return;
            }
            
            // Test App plugin
            try {
                const appInfo = await window.Capacitor.Plugins.App.getInfo();
                results.push(`✅ App plugin: ${appInfo.name} v${appInfo.version}`);
            } catch (e) {
                results.push(`❌ App plugin failed: ${e.message}`);
            }
            
            // Test Device plugin
            try {
                const deviceInfo = await window.Capacitor.Plugins.Device.getInfo();
                results.push(`✅ Device plugin: ${deviceInfo.platform} ${deviceInfo.model}`);
            } catch (e) {
                results.push(`❌ Device plugin failed: ${e.message}`);
            }
            
            document.getElementById('test-results').textContent = results.join('\n');
        }
        
        function copyReport() {
            const report = {
                environment: collectEnvironmentInfo(),
                capacitor: checkCapacitor(),
                errors: errorLog,
                timestamp: new Date().toISOString()
            };
            
            const reportText = JSON.stringify(report, null, 2);
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(reportText).then(() => {
                    alert('Debug report copied to clipboard!');
                }).catch(() => {
                    alert('Failed to copy. Report logged to console.');
                    console.log('DEBUG REPORT:', reportText);
                });
            } else {
                alert('Clipboard not available. Report logged to console.');
                console.log('DEBUG REPORT:', reportText);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            collectEnvironmentInfo();
            checkCapacitor();
        });
    </script>
</body>
</html>