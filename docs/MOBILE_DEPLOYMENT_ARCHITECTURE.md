# Rishi Platform Mobile Deployment Architecture

## Overview

The Rishi Platform implements a sophisticated multi-platform deployment architecture that ensures optimal performance and functionality across web and mobile environments while maintaining strict security and environment separation.

## Architecture Components

### 1. Development Environment
- **Platform**: Replit workspace
- **Purpose**: Local development and testing
- **Configuration**: Standard Next.js with hot reload
- **Database**: Development Neon PostgreSQL instance
- **Environment Variables**: `.env.development`

### 2. Web Production Environment  
- **Platform**: Vercel serverless deployment
- **Purpose**: Primary web application for desktop and mobile browsers
- **Configuration**: Full Next.js with API routes as serverless functions
- **Database**: Production Neon PostgreSQL instance
- **Environment Variables**: Vercel environment configuration
- **Features**: Server-side rendering, API endpoints, full platform functionality

### 3. Mobile Production Environment
- **Platform**: Native Android/iOS applications via VoltBuilder
- **Purpose**: Native mobile apps for field workers and mobile users
- **Configuration**: Static exported frontend with Capacitor native bridge
- **Backend**: Remote API calls to Vercel production deployment
- **Environment Variables**: Mobile-specific configuration
- **Features**: Offline support, native device access, push notifications

## Build Pipeline

### Web Deployment Pipeline
```
Source Code → Vercel Build → Production Web Application
            ↓
       API Routes become Serverless Functions
            ↓
       Database Connections via Neon PostgreSQL
```

### Mobile Deployment Pipeline
```
Source Code → scripts/build-mobile.sh → Mobile Package
            ↓
       Next.js Static Export (out/ directory)
            ↓
       VoltBuilder Cloud Compilation
            ↓
       Native Android/iOS Binaries
            ↓
       Firebase App Distribution
```

## Configuration Separation

### Web Configuration (`next.config.mjs`)
- **Output**: Server mode for Vercel serverless functions
- **Images**: Optimized with domains and formats
- **API Routes**: Full server-side functionality
- **Database**: Direct PostgreSQL connections
- **Security**: Production security headers

### Mobile Configuration (Generated by build script)
- **Output**: Static export (`output: 'export'`)
- **Images**: Unoptimized for mobile compatibility
- **API Routes**: Removed (uses remote Vercel APIs)
- **Database**: Build-time only for static generation
- **Security**: Mobile-specific security configuration

## Environment Variables

### Development (`.env.development`)
```env
NODE_ENV=development
NEXT_PUBLIC_APP_ENV=development
DATABASE_URL=<development-database>
```

### Web Production (Vercel)
```env
NODE_ENV=production
NEXT_PUBLIC_APP_ENV=production
DATABASE_URL=<production-database>
# Full server-side environment variables
```

### Mobile Production (Generated)
```env
NODE_ENV=production
NEXT_PUBLIC_APP_ENV=production
NEXT_PUBLIC_API_BASE_URL=https://rishi-platform.vercel.app
DATABASE_URL=<production-database>
MOBILE_BUILD=true
```

## Capacitor Configuration

### TypeScript-Compliant Configuration
```typescript
import { CapacitorConfig, KeyboardResize, KeyboardStyle } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.rishi.platform',
  appName: 'Rishi Platform',
  webDir: 'out',
  server: {
    androidScheme: 'https',
    url: 'https://rishi-platform.vercel.app',
    cleartext: false
  },
  // Mobile-specific plugin configurations
};
```

## Build Script Usage

### Automated Mobile Package Generation
```bash
# Generate mobile deployment package
./scripts/build-mobile.sh

# Output: rishi-platform-mobile-YYYY-MM-DD-HHMM.zip
# Ready for VoltBuilder upload
```

### Build Script Features
- **Source Isolation**: Creates separate mobile build directory
- **Configuration Override**: Generates mobile-specific configurations
- **Environment Setup**: Creates proper environment variables
- **Package Generation**: Creates VoltBuilder-ready ZIP package
- **Cleanup**: Removes temporary build artifacts

## Security Architecture

### Environment Separation
- **Development**: Isolated development database and configuration
- **Web Production**: Full server-side security with production database
- **Mobile Production**: Static frontend with secure API communication

### Data Flow Security
- **Web**: Direct database connections with server-side validation
- **Mobile**: API-only access through Vercel endpoints with token authentication
- **No Fallbacks**: Strict fail-fast security principle maintained across all platforms

## VoltBuilder Integration

### Cloud Compilation Service
- **Input**: Mobile package ZIP file
- **Process**: Cloud-based Android/iOS compilation
- **Output**: Native application binaries
- **Configuration**: `voltbuilder.json` for build specifications

### Android Configuration
```json
{
  "platform": "android",
  "android": {
    "minSdkVersion": 22,
    "targetSdkVersion": 34,
    "compileSdkVersion": 34
  }
}
```

## Deployment Verification

### Pre-Deployment Checklist
- [ ] Web production deployed and functional on Vercel
- [ ] Mobile package generated with correct static export
- [ ] Environment variables properly configured
- [ ] Capacitor configuration TypeScript-compliant
- [ ] VoltBuilder package includes all necessary files
- [ ] API endpoints accessible from mobile configuration

### Post-Deployment Verification
- [ ] Native app compiles successfully on VoltBuilder
- [ ] Mobile app connects to production API endpoints
- [ ] Offline functionality works as expected
- [ ] Native device features accessible through Capacitor
- [ ] Push notifications properly configured

## Maintenance and Updates

### Web Updates
- Deploy directly to Vercel
- API changes automatically available to mobile apps
- Database migrations apply to all platforms

### Mobile Updates
- Regenerate mobile package with build script
- Upload new package to VoltBuilder
- Distribute updated binaries through Firebase App Distribution
- No app store submission required

## Performance Optimization

### Web Performance
- Server-side rendering for optimal SEO
- Serverless functions for scalable API endpoints
- CDN distribution through Vercel Edge Network

### Mobile Performance
- Static assets for fastest mobile loading
- Offline-first architecture with local caching
- Native performance through Capacitor optimization
- Efficient API calls to remote Vercel deployment

This architecture ensures optimal performance, security, and maintainability across all deployment targets while maintaining strict separation of concerns and environment isolation.